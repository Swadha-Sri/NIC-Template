{% extends 'base/public_base.html' %}
{% block title %}Solar Analytics | Dashboard{% endblock %}
{% block content %}
            <!-- Content Row/ Breadcrumb -->
            <div class="my-5" id="b-homedb">
               <div class="container">
                  <h4 class="text-center mb-3 b-latest-data">Solar Panel Analytics</h4>
                  <div class="pl-4 text-end" style="font-size: 24px">
                     <span class="mr-2" id="one-item-row" style="cursor: pointer;">
                     <i class="fas fa-bars"></i>
                     </span>
                     <span class="mr-2" id="two-item-row" style="cursor: pointer;">
                     <i class="fas fa-th-large"></i>
                     </span>
                     <span class="mr-2" id="three-item-row" style="cursor: pointer;">
                     <i class="fas fa-th"></i>
                     </span>
                  </div>
                  <div class="">
                     <div class="row text-center pl-4" id="sortable-cards">
                        <div class="col-lg-6 col-sm-12 p-3 b-customize">
                           <div class="bg-light p-4 b-dbcard">
                              <i class="fas fa-bullseye position-absolute" style="font-size:35px; right: 40px; top: 40px;"></i>
                              <div class="">
                                 <p class="text-start fw-bold" style="font-size: 14px;">Total Target (All Years)</p>
                                 <h3 class="text-start fw-bold" style="margin-top: -5px">{{ solar_total_target }}</h3>
                                 <div class="text-start" style="margin: 10px 0px 5px;">
                                    <span class="badge bg-info">Overall</span>
                                    <span style="font-size:13px;"> Target capacity</span>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="col-lg-6 col-sm-12 p-3 b-customize">
                           <div class="bg-light p-4 b-dbcard">
                              <i class="fas fa-book position-absolute" style="font-size:35px; right: 40px; top: 40px;"></i>
                              <div class="">
                                 <p class="text-start fw-bold" style="font-size: 14px;">Total Booking (All Years)</p>
                                 <h3 class="text-start fw-bold" style="margin-top: -5px">{{ solar_total_booking }}</h3>
                                 <div class="text-start" style="margin: 10px 0px 5px;">
                                    <span class="badge bg-info">Overall</span>
                                    <span style="font-size:13px;"> Booking count</span>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="col-lg-6 col-sm-12 p-3 b-customize">
                           <div class="bg-light p-4 b-dbcard">
                              <i class="fas fa-solar-panel position-absolute" style="font-size:35px; right: 40px; top: 40px;"></i>
                              <div class="">
                                 <p class="text-start fw-bold" style="font-size: 14px;">Total Installed (All Years)</p>
                                 <h3 class="text-start fw-bold" style="margin-top: -5px">{{ solar_total_installed }}</h3>
                                 <div class="text-start" style="margin: 10px 0px 5px;">
                                    <span class="badge bg-success">{{ solar_install_rate }}</span>
                                    <span style="font-size:13px;"> Install rate</span>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="col-lg-6 col-sm-12 p-3 b-customize">
                           <div class="bg-light p-4 b-dbcard">
                              <i class="fas fa-ban position-absolute" style="font-size:35px; right: 40px; top: 40px;"></i>
                              <div class="">
                                 <p class="text-start fw-bold" style="font-size: 14px;">Rejection Rate</p>
                                 <h3 class="text-start fw-bold" style="margin-top: -5px">{{ solar_reject_rate }}</h3>
                                 <div class="text-start" style="margin: 10px 0px 5px;">
                                    <span class="badge bg-warning text-dark">Overall</span>
                                    <span style="font-size:13px;"> Rejected vs booking</span>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="row my-5 mx-sm-5">
               <div class="col-md-6">
                  <h4 class="text-center">Installed by Year</h4>
                  <canvas id="solarYearInstalledChart" width="400" height="400"></canvas>
               </div>
               <div class="col-md-6">
                  <h4 class="text-center">Overall Installed vs Remaining Target</h4>
                  <canvas id="solarInstalledShareChart" width="400" height="400"></canvas>
               </div>
            </div>
            <div class="row my-5 mx-sm-5">
               <div class="col-md-6">
                  <h4 class="text-center">Top 10 Districts by Installed</h4>
                  <canvas id="solarTopInstalledChart" width="400" height="400"></canvas>
               </div>
               <div class="col-md-6">
                  <h4 class="text-center">Top 10: Target vs Installed</h4>
                  <canvas id="solarTargetVsInstalledChart" width="400" height="400"></canvas>
               </div>
            </div>
         </div>
         <!-- /#page-content-wrapper -->
      </div>
      {% endblock %}

{% block js %}
<script>
   document.addEventListener("DOMContentLoaded", function () {
      const yearLabels = {{ solar_year_labels|safe }};
      const yearInstalled = {{ solar_year_installed|safe }};
      const topLabels = {{ solar_top_labels|safe }};
      const topInstalled = {{ solar_top_installed|safe }};
      const topTarget = {{ solar_top_target|safe }};

      const solarYearInstalledChart = document.getElementById("solarYearInstalledChart");
      if (solarYearInstalledChart) {
         new Chart(solarYearInstalledChart, {
            type: "line",
            data: {
               labels: yearLabels,
               datasets: [
                  {
                     label: "Installed",
                     data: yearInstalled,
                     borderColor: "rgba(54, 162, 235, 1)",
                     backgroundColor: "rgba(54, 162, 235, 0.2)",
                     borderWidth: 2,
                     tension: 0.4,
                     fill: true,
                  },
               ],
            },
            options: {
               responsive: true,
               scales: {
                  y: { beginAtZero: true },
               },
            },
         });
      }

      const solarInstalledShareChart = document.getElementById("solarInstalledShareChart");
      if (solarInstalledShareChart) {
         new Chart(solarInstalledShareChart, {
            type: "doughnut",
            data: {
               labels: ["Installed", "Remaining Target"],
               datasets: [
                  {
                     data: [{{ solar_total_installed_value }}, {{ solar_remaining_target }}],
                     backgroundColor: ["rgba(75, 192, 192, 1)", "rgba(255, 99, 132, 1)"],
                  },
               ],
            },
            options: { responsive: true },
         });
      }

      const solarTopInstalledChart = document.getElementById("solarTopInstalledChart");
      if (solarTopInstalledChart) {
         new Chart(solarTopInstalledChart, {
            type: "bar",
            data: {
               labels: topLabels,
               datasets: [
                  {
                     label: "Installed",
                     data: topInstalled,
                     backgroundColor: "rgba(54, 162, 235, 0.7)",
                  },
               ],
            },
            options: {
               responsive: true,
               scales: {
                  y: { beginAtZero: true },
               },
            },
         });
      }

      const solarTargetVsInstalledChart = document.getElementById("solarTargetVsInstalledChart");
      if (solarTargetVsInstalledChart) {
         new Chart(solarTargetVsInstalledChart, {
            type: "bar",
            data: {
               labels: topLabels,
               datasets: [
                  {
                     label: "Target",
                     data: topTarget,
                     backgroundColor: "rgba(255, 159, 64, 0.7)",
                  },
                  {
                     label: "Installed",
                     data: topInstalled,
                     backgroundColor: "rgba(75, 192, 192, 0.7)",
                  },
               ],
            },
            options: {
               responsive: true,
               scales: {
                  y: { beginAtZero: true },
               },
            },
         });
      }
   });
</script>
{% endblock %}
